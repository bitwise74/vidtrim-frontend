import"../chunks/CWj6FrbW.js";import{s as F,d as he,o as ke,c as De,h as Se,e as oe}from"../chunks/CkHgP2aA.js";import{z as me,b as P,d as e,A as a,r as t,n as Y,B as ne,a as D,C as pe,f as X,c as je,m as f,$ as Ee,G as re,F as fe}from"../chunks/Btcb0jqc.js";import{s as de,a as be,i as ue}from"../chunks/AYVHNyoE.js";import{s as Le,a as ge,v as H,c as le,e as Ie,S as Te,b as we}from"../chunks/Cootxlri.js";import{b as Ve}from"../chunks/BefBN_yz.js";import{P as C,H as Be}from"../chunks/DlTNSVnf.js";import{g as ye}from"../chunks/CMM5F5IC.js";import"../chunks/Fttd8Obw.js";import{i as xe}from"../chunks/Cp_TN7Xo.js";import{s as ve}from"../chunks/DDWaXS3i.js";async function $e(l){if(l.page<0)throw new Error("Page can't be smaller than 0");if(l.limit<1||l.limit>250)throw new Error("Limit must be between 1-250");const i=await fetch(`${C}/api/files/bulk?limit=${l.limit}&page=${l.page}`,{method:"GET",credentials:"include"}),v=await i.json();if(i.status===200)return v;switch(console.error(`[${v.requestID}] LoadVideos request failed: ${v.error}`),i.status){case 400:throw new Error("Reqest is invalid");case 401:return ye("/login"),[];case 404:return[];default:throw new Error("Something went wrong, please check the console for more information")}}async function Fe(l,i){if(l==="")return $e({limit:i,page:0});const v=await fetch(`${C}/api/files/search?query=${encodeURIComponent(l)}&limit=${i}`,{credentials:"include"}),S=await v.json();if(v.status===200)return S;switch(console.error(`[${S.requestID}] LoadVideos request failed: ${S.error}`),v.status){case 400:throw new Error("Request is invalid");default:throw new Error("Something went wrong, please check the console for more information")}}async function Pe(l){const i=await fetch(`${C}/api/files/${l}`,{method:"DELETE",credentials:"include"}),v=await i.json();if(i.status===200)return v;throw new Error(v.error)}var ze=P('<div class="row g-4 mb-5"><div class="col-md-6 col-lg-3 d-flex"><div class="card border-0 shadow-sm h-100 w-100"><div class="card-body d-flex flex-column justify-content-between"><div class="d-flex align-items-center justify-content-between"><div><h6 class="text-muted mb-2">Total Videos</h6> <h3 class="mb-0"> </h3></div> <i class="bi bi-file-earmark-play text-muted fs-2"></i></div></div></div></div> <div class="col-md-6 col-lg-3 d-flex"><div class="card border-0 shadow-sm h-100 w-100"><div class="card-body d-flex flex-column justify-content-between"><div class="d-flex align-items-center justify-content-between"><div class="w-100"><h6 class="text-muted mb-2">Storage Used</h6> <h3 class="mb-2"> </h3> <div class="progress mb-2" style="height: 8px;"><div class="progress-bar bg-dark"></div></div></div> <i class="bi bi-hdd text-muted fs-2"></i></div></div></div></div> <div class="col-md-6 col-lg-3 d-flex"><div class="card border-0 shadow-sm h-100 w-100"><div class="card-body d-flex flex-column justify-content-between"><div class="d-flex align-items-center justify-content-between"><div><h6 class="text-muted mb-2">Total Views</h6> <h3 class="mb-0"> </h3></div> <i class="bi bi-eye text-muted fs-2"></i></div></div></div></div> <div class="col-md-6 col-lg-3 d-flex"><div class="card border-0 shadow-sm h-100 w-100"><div class="card-body d-flex flex-column justify-content-between"><div class="d-flex align-items-center justify-content-between"><div><h6 class="text-muted mb-2">Watch Time</h6> <h3 class="mb-0"> </h3></div> <i class="bi bi-clock text-muted fs-2"></i></div></div></div></div></div>');function Ce(l,i){me(i,!1);const[v,S]=be(),b=()=>de(ge,"$stats",v);function u(T,q=2){return(T/1e9).toFixed(q)}xe();var y=ze(),x=e(y),j=e(x),E=e(j),p=e(E),z=e(p),g=a(e(z),2),K=e(g,!0);t(g),t(z),Y(2),t(p),t(E),t(j),t(x);var w=a(x,2),o=e(w),d=e(o),m=e(d),c=e(m),r=a(e(c),2),h=e(r);t(r);var L=a(r,2),$=e(L);t(L),t(c),Y(2),t(m),t(d),t(o),t(w);var O=a(w,2),J=e(O),Q=e(J),s=e(Q),n=e(s),_=a(e(n),2),I=e(_,!0);t(_),t(n),Y(2),t(s),t(Q),t(J),t(O);var M=a(O,2),U=e(M),G=e(U),A=e(G),R=e(A),N=a(e(R),2),W=e(N,!0);t(N),t(R),Y(2),t(A),t(G),t(U),t(M),t(y),ne((T,q)=>{F(K,b().uploadedFiles),F(h,`${T??""}/${q??""}`),Le($,`width: ${b().usedStorage/b().maxStorage*100}%`),F(I,b().totalViews),F(W,b().totalWatchTime)},[()=>u(b().usedStorage),()=>u(b().maxStorage,0)+" GB"]),D(l,y),pe(),S()}var Oe=(l,i)=>i("play"),Ue=(l,i)=>i("edit"),Re=(l,i)=>i("download"),qe=(l,i)=>i("share"),Me=(l,i)=>i("copy-link"),Ge=(l,i)=>i("delete"),Ae=P('<div class="dropdown"><button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="dropdown" aria-label="Options" aria-expanded="false"><i class="bi bi-three-dots-vertical"></i></button> <ul class="dropdown-menu"><li><button class="dropdown-item" aria-label="Play video"><i class="bi bi-play me-2"></i>Play</button></li> <li><button class="dropdown-item" aria-label="Edit video"><i class="bi bi-pencil me-2"></i>Edit</button></li> <li><button class="dropdown-item" aria-label="Download video"><i class="bi bi-download me-2"></i>Download</button></li> <li><button class="dropdown-item" aria-label="Share video"><i class="bi bi-share me-2"></i>Share</button></li> <li><button class="dropdown-item" aria-label="Copy video link"><i class="bi bi-link me-2"></i>Copy Link</button></li> <li><hr class="dropdown-divider"/></li> <li><button class="dropdown-item text-danger" aria-label="Delete video"><i class="bi bi-trash me-2"></i>Delete</button></li></ul></div>');function Ne(l,i){me(i,!0);const[v,S]=be(),b=()=>de(H,"$videos",v);async function u(h){if(b().find($=>$.id===i.videoID))switch(h){case"play":le.set(`${C}/api/files/${i.videoID}?t=0`);break;case"edit":ye(`/editor&id=${i.videoID}`);break;case"download":window.location.href=`${C}/api/files/${i.videoID}?t=0`;break;case"share":navigator.share({url:`${C}/api/files/${i.videoID}?t=0`});break;case"copy-link":navigator.clipboard.writeText(`${C}/api/files/${i.videoID}?t=0`);break;case"delete":const $=await Pe(i.videoID);H.set(b().filter(O=>O.id!=i.videoID)),ge.set($);break;default:console.error("unknown video action",h)}}var y=Ae(),x=a(e(y),2),j=e(x),E=e(j);E.__click=[Oe,u],t(j);var p=a(j,2),z=e(p);z.__click=[Ue,u],t(p);var g=a(p,2),K=e(g);K.__click=[Re,u],t(g);var w=a(g,2),o=e(w);o.__click=[qe,u],t(w);var d=a(w,2),m=e(d);m.__click=[Me,u],t(d);var c=a(d,4),r=e(c);r.__click=[Ge,u],t(c),t(x),t(y),D(l,y),pe(),S()}he(["click"]);var We=l=>l.stopPropagation(),He=P('<div class="modal-backdrop show pt-0"></div> <div class="modal show d-block pt-0 d-flex" tabindex="-1"><div class="modal-dialog modal-xl py-0 align-content-center justify-content-center"><div class="modal-content"><video controls autoplay class="w-100" volume="50"><track kind="captions"/></video></div></div></div>',3),Ke=P('<div class="text-center py-5"><div class="d-flex align-items-center justify-content-center rounded-circle bg-light mx-auto mb-4" style="width: 96px; height: 96px;"><i class="bi bi-file-earmark-play text-muted display-4"></i></div> <h4 class="fw-semibold mb-3">No videos yet</h4> <p class="text-muted mb-4">Upload your first video by drag and dropping it here or going to the editor</p> <a href="/editor" class="btn btn-dark">Open Editor</a></div>'),Ze=P('<img class="w-100 h-100 object-fit-cover" alt="placeholder"/> <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center flex-column opacity-1 gap-1" style="background: rgba(0,0,0,0.3);"><i class="spinner-border text-white mt-3" role="status"></i> <p class="text-white">Processing...</p></div>',1),Je=P('<img class="w-100 h-100" style="object-fit: contain;"/> <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center opacity-0 hover-overlay svelte-2id5j" style="background: rgba(0,0,0,0.3);"><button class="btn bg-black btn-sm text-white" aria-label="Play video"><i class="bi bi-play-fill me-1"></i>Play</button></div> <div class="position-absolute bottom-0 end-0 m-2"><span class="badge bg-black bg-opacity-75"> </span></div>',1),Qe=P('<div class="col-sm-6 col-lg-4 col-xl-3 mb-3"><div class="card d-flex flex-column h-100 border-0 shadow-sm card-hover svelte-2id5j"><div class="position-relative aspect-video bg-light overflow-hidden rounded-2"><!></div> <div class="card-body p-3"><div class="d-flex align-items-start justify-content-between mb-2"><h6 class="card-title mb-0 line-clamp-2 flex-grow-1 overflow-hidden pe-2"> </h6> <!></div> <div class="d-flex align-items-center justify-content-between small text-muted mb-2"><span> </span> <span class="badge bg-dark p-2"> </span></div> <div class="d-flex align-items-center justify-content-between small text-muted"><span> </span> <span> </span></div></div></div></div>'),Xe=P("<!> <!>",1);function Ye(l,i){me(i,!1);const[v,S]=be(),b=()=>de(le,"$currentVideoURL",v),u=()=>de(H,"$videos",v);function y(o){const d=Math.floor(o/3600),m=Math.floor(o%3600/60),c=Math.floor(o%60);return d>0?`${d.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`:`${m.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`}function x(o){if(o<1024)return`${o} B`;const d=o/1024;if(d<1024)return`${d.toFixed(2)} KB`;const m=d/1024;return m<1024?`${m.toFixed(2)} MB`:`${(m/1024).toFixed(2)} GB`}function j(o){return new Date(o*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}xe();var E=Xe(),p=X(E);{var z=o=>{var d=He(),m=X(d);m.__click=()=>le.set("");var c=a(m,2);c.__click=()=>le.set("");var r=e(c);r.__click=[We];var h=e(r),L=e(h);t(h),t(r),t(c),ne(()=>ve(L,"src",b())),D(o,d)};ue(p,o=>{b()!==""&&o(z)})}var g=a(p,2);{var K=o=>{var d=Ke();D(o,d)},w=o=>{var d=je(),m=X(d);Ie(m,1,u,c=>c.id,(c,r)=>{var h=Qe(),L=e(h),$=e(L),O=e($);{var J=k=>{var V=Ze(),B=X(V);ve(B,"src","placeholder.svg"),Y(2),D(k,V)},Q=k=>{var V=Je(),B=X(V),Z=a(B,2),te=e(Z);te.__click=()=>le.set(`${C}/api/files/${f(r).id}?t=0`),t(Z);var ae=a(Z,2),ie=e(ae),_e=e(ie,!0);t(ie),t(ae),ne(se=>{ve(B,"src",`${C}/api/files/${f(r).id}?t=1`),ve(B,"alt",f(r).name),F(_e,se)},[()=>y(f(r).duration)]),D(k,V)};ue(O,k=>{f(r).state=="processing"?k(J):k(Q,!1)})}t($);var s=a($,2),n=e(s),_=e(n),I=e(_,!0);t(_);var M=a(_,2);Ne(M,{get videoID(){return f(r).id}}),t(n);var U=a(n,2),G=e(U),A=e(G,!0);t(G);var R=a(G,2),N=e(R,!0);t(R),t(U);var W=a(U,2),T=e(W),q=e(T,!0);t(T);var ee=a(T,2),ce=e(ee);t(ee),t(W),t(s),t(L),t(h),ne((k,V,B)=>{F(I,f(r).name),F(A,k),F(N,V),F(q,B),F(ce,`${f(r).views??""} views`)},[()=>j(f(r).created_at),()=>f(r).format.toUpperCase().slice(6),()=>x(f(r).size)]),D(c,h)}),D(o,d)};ue(g,o=>{u().length===0?o(K):o(w,!1)})}D(l,E),pe(),S()}he(["click"]);var et=P('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Failed to load your dashboard:</strong> <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>'),tt=P('<!> <div class="row g-3 mb-4"><div class="col-lg-8 col-md-7"><div class="input-group"><span class="input-group-text"><i class="bi bi-search"></i></span> <input type="text" class="form-control" placeholder="Search videos..."/></div></div> <div class="col-lg-3 col-md-3 col-sm-6"><select class="form-select"><option>Newest First</option><option>Oldest First</option><option>Name A-Z</option><option>Size</option><option>Most Views</option></select></div> <div class="col-lg-1 col-md-2 col-sm-6"><select class="form-select" disabled placeholder="Results per page"><option selected>10</option><option>20</option><option>50</option><option>100</option><option>250</option></select></div></div> <div class="row"><!></div>',1),at=P(`<div class="min-vh-100 bg-light position-relative"><div class="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50 d-none
           justify-content-center align-items-center z-3" id="dropOverlay"><div class="border border-3 border-dashed border-light rounded-4 p-5 text-center"><i class="bi bi-cloud-upload text-light display-1 mb-3"></i> <h3 class="text-light fw-semibold">Drop files to upload</h3></div></div> <!> <main class="container py-4"><!> <div></div></main></div>`);function pt(l,i){me(i,!0);const[v,S]=be(),b=()=>de(H,"$videos",v);let u=fe(null),y=0,x=fe("10"),j=fe("newest"),E=!1,p,z,g;ke(()=>{p=document.getElementById("dropOverlay"),window.addEventListener("dragenter",w),window.addEventListener("dragend",o),fetch(`${C}/api/users`,{method:"GET",credentials:"include"}).then(n=>n.json()).then(n=>{H.set(n.videos),ge.set(n.stats)}).catch(n=>{re(u,n,!0)});const s=new IntersectionObserver(n=>{n[0].isIntersecting&&m()});return g&&s.observe(g),()=>{s.disconnect(),window.removeEventListener("dragenter",w),window.removeEventListener("dragend",o)}}),De(()=>{clearTimeout(z)});function K(s){clearTimeout(z);const n=s.target.value;z=setTimeout(async()=>{H.set(await Fe(n,parseInt(f(x))))},300)}function w(s){s.dataTransfer.types.includes("Files")&&p&&(p.classList.remove("d-none"),p.classList.add("d-flex"))}function o(){p&&(p.classList.add("d-none"),p.classList.remove("d-flex"))}async function d(s){if(o(),s.preventDefault(),!s.dataTransfer)return;const _=Array.from(s.dataTransfer.files).find(I=>I.type.startsWith("video/"));if(_){H.set([{state:"processing",size:_.size,format:"video/mp4",created_at:Date.now(),views:0,name:_.name},...b()]);try{await Te(_),window.location.reload()}catch(I){re(u,I,!0),window.scrollTo(0,0)}}}async function m(){if(!E){E=!0,y++;try{const s=await $e({page:y,limit:10});H.set([...b(),...s])}catch(s){re(u,s,!0),window.scrollTo(0,0)}finally{E=!1}}}var c=at();Se(s=>{Ee.title="Dashboard - vid.sh"});var r=e(c),h=a(r,2);Be(h,{title:"Dashboard",page:"dashboard"});var L=a(h,2),$=e(L);{var O=s=>{var n=et(),_=a(e(n));Y(),t(n),ne(()=>F(_,` ${f(u)??""} `)),D(s,n)},J=s=>{var n=tt(),_=X(n);Ce(_,{});var I=a(_,2),M=e(I),U=e(M),G=a(e(U),2);G.__input=K,t(U),t(M);var A=a(M,2),R=e(A),N=e(R);N.value=N.__value="newest";var W=a(N);W.value=W.__value="oldest";var T=a(W);T.value=T.__value="az";var q=a(T);q.value=q.__value="size";var ee=a(q);ee.value=ee.__value="views",t(R),t(A);var ce=a(A,2),k=e(ce),V=e(k);V.value=V.__value="10";var B=a(V);B.value=B.__value="20";var Z=a(B);Z.value=Z.__value="50";var te=a(Z);te.value=te.__value="100";var ae=a(te);ae.value=ae.__value="250",t(k),t(ce),t(I);var ie=a(I,2),_e=e(ie);Ye(_e,{}),t(ie),we(R,()=>f(j),se=>re(j,se)),we(k,()=>f(x),se=>re(x,se)),D(s,n)};ue($,s=>{f(u)?s(O):s(J,!1)})}var Q=a($,2);Ve(Q,s=>g=s,()=>g),t(L),t(c),oe("dragenter",r,w),oe("dragover",r,s=>s.preventDefault()),oe("dragend",r,o),oe("dragleave",r,o),oe("drop",r,d),D(l,c),pe(),S()}he(["input"]);export{pt as component};
